{"version":3,"sources":["webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/categories/index.js","webpack:///./src/pages/categories/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableList","constructor","items","clientX","clientY","this","moveDraggingAt","prevElem","placeholderElement","previousElementSibling","nextElem","nextElementSibling","firstElementChild","lastElementChild","element","top","firstElementTop","getBoundingClientRect","bottom","before","after","height","scrollIfCloseToWindowEdge","dragStop","render","document","createElement","className","addItems","initEventListeners","item","classList","add","append","addEventListener","event","onPointerDown","target","closest","preventDefault","console","log","innerHTML","dragStart","remove","createPlaceholderElement","width","style","draggingElem","elementInitialIndex","children","indexOf","x","y","offsetWidth","offsetHeight","pointerShift","addDocumentEventListeners","onPointerMove","onPointerUp","removeDocumentEventListeners","removeEventListener","left","window","scrollBy","documentElement","clientHeight","placeholderIndex","cssText","replaceWith","dispatchEvent","from","to","type","details","CustomEvent","bubbles","destroy","Categories","url","refs","sort","isSortLocally","async","elem","toggle","dragging","Event","URL","loadData","addEventListeners","handler","wrapper","getTemplate","searchParams","set","data","fetchJson","renderRows","getTables","length","arr","getTable","push","id","title","dataset","subcategory","getSubcategories","subcategories","querySelector","initSortableList","map","getListItem","count","addRows","arrCategory","insertAdjacentElement","getSubElements","subElements","elements","querySelectorAll","Page","initComponents","categories","components","randerComponents","Object","keys","forEach","component","root","template","reduce","accum","subElement","initEventListener","rangePicker","detail","updateComponents","params","response","body","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","message","status","Error","super","reason","alert"],"mappings":"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","file":"categories-index-js-1.js","sourcesContent":["export default class SortableList {\r\n  \r\n  onPointerMove = ({ clientX, clientY }) => {\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    const prevElem = this.placeholderElement.previousElementSibling;\r\n    const nextElem = this.placeholderElement.nextElementSibling;\r\n\r\n    const { firstElementChild, lastElementChild } = this.element;\r\n    const { top: firstElementTop } = firstElementChild.getBoundingClientRect();\r\n    const { bottom } = this.element.getBoundingClientRect();\r\n\r\n    if (clientY < firstElementTop) {\r\n      return firstElementChild.before(this.placeholderElement);\r\n    }\r\n\r\n    if (clientY > bottom) {\r\n      return lastElementChild.after(this.placeholderElement);\r\n    }\r\n\r\n    if (prevElem) {\r\n      const { top, height } = prevElem.getBoundingClientRect();\r\n      const middlePrevElem = top + height / 2;\r\n\r\n      if (clientY < middlePrevElem) {\r\n        return prevElem.before(this.placeholderElement);\r\n      }\r\n    }\r\n\r\n    if (nextElem) {\r\n      const { top, height } = nextElem.getBoundingClientRect();\r\n      const middleNextElem = top + height / 2;\r\n\r\n      if (clientY > middleNextElem && nextElem.nextElementSibling) {\r\n        return nextElem.after(this.placeholderElement);\r\n      } else if (!nextElem.nextElementSibling ) {\r\n           return nextElem.before(this.placeholderElement);\r\n      } \r\n    }\r\n\r\n    this.scrollIfCloseToWindowEdge(clientY);\r\n  };\r\n\r\n  onPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({ items = [] } = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n\r\n    this.addItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  addItems() {\r\n    // item is a DOM element\r\n    for (const item of this.items) {\r\n      item.classList.add('sortable-list__item');\r\n    }\r\n\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  initEventListeners () {\r\n    this.element.addEventListener('pointerdown', event => {\r\n      this.onPointerDown(event);\r\n    });\r\n  }\r\n\r\n  onPointerDown (event) {\r\n    const element = event.target.closest('.sortable-list__item');\r\n\r\n    if (element) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n        console.log(`dragStart: + ${element.innerHTML}`);\r\n        this.dragStart(element, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n\r\n        element.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  createPlaceholderElement (width, height) {\r\n    const element = document.createElement('li');\r\n\r\n    element.className = 'sortable-list__placeholder';\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n\r\n    return element;\r\n  }\r\n\r\n  dragStart(element, {clientX, clientY}) {\r\n    this.draggingElem = element;\r\n    this.elementInitialIndex = [...this.element.children].indexOf(element);\r\n\r\n    const { x, y } = element.getBoundingClientRect();\r\n    const { offsetWidth, offsetHeight } = element;\r\n\r\n    this.pointerShift = {\r\n      x: clientX - x,\r\n      y: clientY - y\r\n    };\r\n\r\n    this.draggingElem.style.width = `${offsetWidth}px`;\r\n    this.draggingElem.style.height = `${offsetHeight}px`;\r\n    this.draggingElem.classList.add('sortable-list__item_dragging');\r\n\r\n    this.placeholderElement = this.createPlaceholderElement(offsetWidth, offsetHeight);\r\n\r\n    this.draggingElem.after(this.placeholderElement);\r\n    // move to the end, to be over other list elements\r\n    this.element.append(this.draggingElem);\r\n    this.moveDraggingAt(clientX, clientY);\r\n    this.addDocumentEventListeners();\r\n  }\r\n\r\n  addDocumentEventListeners () {\r\n    document.addEventListener('pointermove', this.onPointerMove);\r\n    document.addEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  removeDocumentEventListeners () {\r\n    document.removeEventListener('pointermove', this.onPointerMove);\r\n    document.removeEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  moveDraggingAt(clientX, clientY) {\r\n    this.draggingElem.style.left = `${clientX - this.pointerShift.x}px`;\r\n    this.draggingElem.style.top = `${clientY - this.pointerShift.y}px`;\r\n     console.log(`this.draggingElem: + ${this.draggingElem.style.x}`);\r\n  }\r\n\r\n  scrollIfCloseToWindowEdge(clientY) {\r\n    const scrollingValue = 10;\r\n    const threshold = 20;\r\n\r\n    if (clientY < threshold) {\r\n      window.scrollBy(0, -scrollingValue);\r\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\r\n      window.scrollBy(0, scrollingValue);\r\n    }\r\n  }\r\n\r\n  dragStop() {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElement);\r\n\r\n    this.draggingElem.style.cssText = '';\r\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\r\n    this.placeholderElement.replaceWith(this.draggingElem);\r\n    this.draggingElem = null;\r\n\r\n    this.removeDocumentEventListeners();\r\n\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.dispatchEvent('sortable-list-reorder', {\r\n        from: this.elementInitialIndex,\r\n        to: placeholderIndex\r\n      });\r\n    }\r\n  }\r\n\r\n  dispatchEvent (type, details) {\r\n\r\n    this.element.dispatchEvent(new CustomEvent(type, {\r\n      bubbles: true,\r\n      details\r\n    }));\r\n\r\n  }\r\n\r\n  remove () {\r\n    if (this.element) {\r\n      this.element.remove();\r\n    }\r\n  }\r\n\r\n  destroy () {\r\n    this.remove();\r\n    this.removeDocumentEventListeners();\r\n    this.element = null;\r\n  }\r\n}","\r\nimport SortableList from \"./../sortable-list/index.js\";\r\nimport fetchJson from \"./../../utils/fetch-json.js\";  //\"./fetch-json.js\";   ///\r\nconst BACKEND_URL = `${process.env.BACKEND_URL}`; \r\n\r\nexport default class Categories {\r\n  element;\r\n  sortedlists;\r\n  subElements = {};\r\n  data = [];\r\n  \r\n  handler = async (event) => {\r\n        const elem = event.target.closest('[data-id]');\r\n        if (elem)  {\r\n           elem.classList.toggle(\"category_open\")\r\n        }\r\n\r\n        const dragging = event.target.closest('[data-grab-handle]');\r\n        if(dragging) {\r\n            let event = new Event('pointerdown'); \r\n            dragging.dispatchEvent(event);\r\n        }\r\n  };\r\n  \r\n  constructor( {\r\n        url = '',  //api/rest/categories?_sort=weight&_refs=subcategory\r\n        refs = '',\r\n        sort = '',\r\n        isSortLocally = false\r\n          } = {}) {\r\n\r\n        this.url = new URL(url, BACKEND_URL);\r\n        this.isSortLocally = isSortLocally;\r\n        this.sort = 'weight';\r\n        this.refs = 'subcategory';\r\n\r\n        this.render();\r\n        this.loadData(this.sort, this.refs);\r\n    \r\n  }\r\n\r\n  addEventListeners() {\r\n        this.element.addEventListener('pointerdown', this.handler);//'click'\r\n       // this.subElements.header.removeEventListener('pointerdown', this.handler);\r\n  }\r\n\r\n  async render() {\r\n\r\n        const wrapper = document.createElement('div');\r\n\r\n        wrapper.innerHTML = this.getTemplate();\r\n\r\n        const element = wrapper.firstElementChild;\r\n\r\n        this.element = element;\r\n\r\n       //this.subElements = this.getSubElements(element);\r\n\r\n  }\r\n\r\n  getTemplate() {\r\n     return ` <div class=\"content\" id=\"content\">\r\n                <div class=\"categories\">\r\n                   <div class=\"content__top-panel\">\r\n                     <h1 class=\"page_title\">Категории товаров</h1>\r\n                   </div>\r\n                   <div data-element=\"categoriesConteiner\" >\r\n                    </div>\r\n                </div>\r\n             </div>`;\r\n  }\r\n\r\n\r\n  async loadData(sort, refs) {\r\n        this.url.searchParams.set('_sort', sort);\r\n        this.url.searchParams.set('_refs', refs);\r\n\r\n        const data = await fetchJson(this.url); // n кол-во времени\r\n        this.renderRows(data);\r\n  }\r\n\r\n   getTables(data=[]) {\r\n        if (!data.length) {\r\n            return [];\r\n        }\r\n        const arr=[];\r\n        for(let item of data) {\r\n            const elem = this.getTable(item);\r\n            arr.push(elem);\r\n        }\r\n         return arr;\r\n   }\r\n\r\n   getTable(item) {\r\n        \r\n        const wrapper = document.createElement('div');\r\n        wrapper.innerHTML = `\r\n            <div class=\"category_open\" data-id=\"${item.id}\">\r\n               <header class=\"category__header\">${item.title}</header>\r\n            </div>`;\r\n         const elem = wrapper.firstElementChild;\r\n         elem.dataset.id = `${item.id}`;\r\n         elem.classList.add(\"category\");\r\n         elem.classList.add(\"category_open\");\r\n         \r\n         const subcategory = this.getSubcategories(item.subcategories)\r\n         const elemement = elem.querySelector(\".category__header\");\r\n         elemement.after(subcategory);\r\n         return elem;\r\n   }\r\n\r\n   getSubcategories(data=[]) {\r\n        const wrapper = document.createElement('div');\r\n        wrapper.innerHTML = `\r\n            <div class=\"category__body\">\r\n                <div class=\"subcategory-list\" ></div>\r\n           </div> \r\n           `;\r\n         const elem = wrapper.firstElementChild;\r\n         const subcategory = this.initSortableList(data);\r\n         const elemement = elem.querySelector(\".subcategory-list\");\r\n         elemement.append(subcategory);\r\n         return elem;\r\n\r\n   }\r\n\r\n\r\n   initSortableList(data) {\r\n        //const { categoriesConteiner } = this.subElements;\r\n        const items = data.map( item => this.getListItem(item.id, item.title, item.count));\r\n        const sortableList = new SortableList({\r\n            items\r\n        });\r\n        return sortableList.element;\r\n\r\n   }\r\n\r\n   getListItem(id, title, count) {\r\n       \r\n        const wrapper = document.createElement('div');\r\n        wrapper.innerHTML = `\r\n        <li class=\"categories__sortable-list-item sortable-list__item\" data-grab-handle>\r\n        <strong >${title} </strong>\r\n        <span> <b>${count}</b> products</span>\r\n        </li>`;\r\n        wrapper.firstElementChild.dataset.id = `${id}`;\r\n        return wrapper.firstElementChild;\r\n   }\r\n\r\n  renderRows(data) {\r\n     if (data.length) {\r\n        this.addRows(data);\r\n     }\r\n  }\r\n\r\n  addRows(data=[]) {\r\n      this.data = data;\r\n\r\n      const arrCategory = this.getTables(this.data);\r\n      const elem = this.element.querySelector('[data-element]');\r\n\r\n      for (let element of arrCategory) {\r\n         elem.insertAdjacentElement('beforeend', element);   \r\n      }\r\n     \r\n      this.addEventListeners();\r\n  }\r\n\r\n  getSubElements(element) {\r\n        const subElements = {};\r\n        const elements = element.querySelectorAll('[data-element]');\r\n\r\n        for (const item of elements) {\r\n          subElements[item.dataset.element] = item;\r\n        }\r\n\r\n        return subElements;\r\n  }\r\n\r\n  remove() {\r\n        this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n        this.remove();\r\n        this.subElements = {};\r\n  }\r\n}","\r\nimport Categories from \"../../components/categories/index.js\";\r\nimport fetchJson from \"../../utils/fetch-json.js\"; \r\n\r\nconst BACKEND_URL = `${process.env.BACKEND_URL}`; \r\n\r\nexport default class Page {\r\n\r\n    element;\r\n    subElements = {};\r\n    components = {};\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    initComponents() {\r\n\r\n        const categories = new Categories( {\r\n             url: 'api/rest/categories',   \r\n             refs: 'subcategory',\r\n             sort: 'weight'\r\n        });\r\n\r\n        this.components = {\r\n            categories\r\n        };\r\n\r\n    }\r\n\r\n    randerComponents() {\r\n        Object.keys(this.components).forEach(component => {\r\n            const root = this.subElements[component];\r\n            const { element } = this.components[component];\r\n\r\n            root.append(element);\r\n        });\r\n    }\r\n\r\n    get template() {\r\n        return `\r\n        <div class=\"content\" id=\"content\">\r\n          <div data-element=\"categories\">\r\n          </div>\r\n        <div>\r\n        `\r\n    }\r\n     render() {\r\n        \r\n        this.element = document.createElement('div'); // (*)\r\n        this.element.innerHTML = this.template;\r\n        this.subElements = this.getSubElements(this.element);\r\n\r\n        this.initComponents();\r\n        this.randerComponents() ;\r\n        return this.element;\r\n     }\r\n\r\n     getSubElements(element) {\r\n         const elements = element.querySelectorAll('[data-element]');\r\n\r\n         return [...elements].reduce((accum, subElement) => {\r\n          accum[subElement.dataset.element] = subElement;\r\n\r\n          return accum;\r\n        }, {});\r\n     }\r\n\r\n     initEventListener() {\r\n         this.components.rangePicker.element.addEventListener('date-select', event => {  \r\n            const {from, to } = event.detail;\r\n            this.updateComponents(from, to);\r\n        });\r\n     }\r\n\r\n\r\n      remove () {\r\n        if (this.element) {\r\n            this.element.remove();\r\n        }\r\n     }\r\n\r\n      destroy() {\r\n        this.remove();\r\n        for(let component in this.components) {\r\n            this.components[component].destroy();\r\n        }\r\n        this.element = null;\r\n        this.subElements = {};\r\n      }\r\n}","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}